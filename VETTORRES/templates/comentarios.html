<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinaria Torres - Comentarios de Clientes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 80%;
            margin: auto;
            padding: 20px;
        }

        h1, h2 {
            text-align: center;
            color: #333;
        }

        .comments-list {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .comment {
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }

        .comment:last-child {
            border-bottom: none;
        }

        .comment .user-name {
            font-weight: bold;
        }

        .comment .comment-text {
            margin-top: 5px;
        }

        .comment .rating {
            color: #f0c040;
        }

        .comment-form {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .comment-form div {
            margin-bottom: 10px;
        }

        .comment-form label {
            display: block;
            margin-bottom: 5px;
        }

        .comment-form textarea,
        .comment-form input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .comment-form button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .rating {
            display: inline-block;
            unicode-bidi: bidi-override;
            direction: rtl;
        }

        .rating input {
            display: none;
        }

        .rating label {
            display: inline-block;
            cursor: pointer;
            color: #ccc;
        }

        .rating label:before {
            content: '\2605';
            font-size: 24px;
        }

        .rating input:checked ~ label {
            color: #f0c040;
        }
    </style>
</head>
<body>

    <div class="container">
        {% if messages %}
            <div class="alert alert-success" role="alert">
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
            </div>
        {% endif %}
    
        <h1>Comentarios de Clientes</h1>
    
        <!-- Lista dinámica de comentarios -->
        <div id="comments-list" class="comments-list">
            {% for comentario in comentarios_info %}
            <div class="comment">
                <div class="user-info">
                    <span class="user-name">{{ comentario.nombre }}</span>
                    <p><em> {{ comentario.usuario }}</em></p>
                    <p><em>Fecha: {{ comentario.fecha|date:"d M Y H:i" }}</em></p>
                    <div class="rating">
                        {{ comentario.estrellas }}  <!--Aquí se muestran las estrellas -->
                    </div>
                </div>
                <div class="comment-text">
                    {{ comentario.comentario }}
                    <!--<strong>{{ comentario.nombre }}</strong>:--> 
                </div>
                {% if comentario.respuesta %}
                <div class="response">
                    <strong>Respuesta del Admin:</strong>
                    <p>{{ comentario.respuesta }}</p>
                </div>
                {% endif %}
            </div>
            {% empty %}
            <p>No hay comentarios aún.</p>
            {% endfor %}
        </div>
        {% if user.is_authenticated %}
        <!-- Formulario para agregar comentario -->
        <form id="comment-form" class="comment-form" method="post" action="{% url 'comentarios_view' %}">
            {% csrf_token %}
            <h2>Agregar Comentario</h2>
            <!--<div>
                <label for="id_nombre">Nombre:</label>
                <input type="text" id="id_nombre" name="nombre" required>
            </div>-->
            <div>
                <label for="id_comentario">Comentario:</label>
                <textarea id="id_comentario" name="comentario" rows="4" required></textarea>
            </div>
            <div>
                <label for="id_rating">Calificación:</label>
                <div id="id_rating" class="rating">
                    <input type="radio" id="id_star5" name="rating" value="5"><label for="id_star5"></label>
                    <input type="radio" id="id_star4" name="rating" value="4"><label for="id_star4"></label>
                    <input type="radio" id="id_star3" name="rating" value="3"><label for="id_star3"></label>
                    <input type="radio" id="id_star2" name="rating" value="2"><label for="id_star2"></label>
                    <input type="radio" id="id_star1" name="rating" value="1"><label for="id_star1"></label>
                </div>
            </div>
            <button type="submit">Enviar Comentario</button>
        </form>
        {% else %}
    <p>Para poder dejar un comentario, debes <a href="{% url 'iniciar_sesion' %}">iniciar sesión</a>.</p>
{% endif %}


        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const commentForm = document.getElementById('comment-form');
        
                commentForm.addEventListener('submit', function(event) {
                    let ratingSelected = false;
        
                    // Verifica si se ha seleccionado alguna calificación
                    const ratingInputs = document.getElementsByName('rating');
                    for (const ratingInput of ratingInputs) {
                        if (ratingInput.checked) {
                            ratingSelected = true;
                            break;
                        }
                    }
        
                    if (!ratingSelected) {
                        // Previene el envío del formulario y muestra una alerta si no se seleccionó una calificación
                        alert('Por favor, selecciona una calificación.');
                        event.preventDefault();
                    }
                });
            });
        </script>
    </div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>